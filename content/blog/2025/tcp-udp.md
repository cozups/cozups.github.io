---
title: "TCP와 UDP"
date: "2025-04-30"
description: "TCP와 UDP에 대하여"
category: "Computer Science"
tags: ["Network"]
---

# TCP (Transmission Control Protocol)

전송 계층(Transport Layer)의 주요 프로토콜 중 하나

## 특징

- **연결 지향**: 하나의 서버에서 여러개의 서버로 동시에 데이터를 보낼 수 있는 UDP와 달리 두 개의 특정 서버 사이의 전용 연결을 형성한다.
- **안정적인 전달**: 네트워크 환경과 상관 없이 안정적으로 세그먼트를 전달한다. 승인, 재전송, 에러 감지 등을 이용하여 데이터 무결성을 보장한다.
- **비트스트림 지향**: TCP는 데이터를 연속적인 비트의 흐름으로 간주한다. 그리고 어디서부터 어디까지가 하나의 메시지인지 구분하지 않고 순차적으로 세그먼트를 보낸다. 중복된 세그먼트는 자동으로 삭제한다.

## TCP 헤더

신뢰성 있는 데이터 전송을 용이하게 하고 데이터를 받는 장치가 세그먼트를 적절하게 다룰 수 있도록하기 위해 TCP 세그먼트에 추가하는 정보

1. **Source Port**: TCP 세그먼트를 전송하는 애플리케이션이나 프로세스의 포트 넘버
2. **Destination Port**: TCP 세그먼트를 받는 애플리케이션이나 프로세스의 포트 넘버
3. **Sequence Number**: TCP 세그먼트의 첫번째 바이트에 할당되는 넘버. 수신측에서 세그먼트 정렬을 돕는다.
4. **Acknowledgment Number**: 송신 측이 데이터의 정상적인 수신을 확인하기 위해 사용하는 일련번호. 정상적으로 받은 데이터의 바이트에 1이 더해진 값.
5. **Control Flags**
   - **SYN(Synchronize)**: TCP 연결 시작 요청
   - **ACK(Acknowledgment)**: 데이터의 수신을 확인
     - N-1까지 잘 받았고 N을 기다리는 중이라는 뜻
   - **FIN(Finish)**: 데이터 수신을 종료하고 연결 종료를 요청
   - **RST(Reset)**: 연결 오류가 있을 때 연결을 초기화 하기 위한 요청
6. **Checksum**: 헤더와 데이터를 포함한 전체 TCP 세그먼트에서 에러 확인을 위한 값.

## TCP 작동 방법

### 1. 연결

- 웹 서버에 연결 요청
- **3-way handshake**로 연결 형성

![image.png](https://miro.medium.com/v2/resize:fit:1100/format:webp/1*boCn6oIpDWQagLSNjL8_aw.png)

### 2. 데이터 세그먼트화

- 다운로드 받고자 하는 파일을 세그먼트나 패킷 단위로 나눔

### 3. 신뢰성 있는 전달

- 클라이언트가 서버로 패킷을 보냄
- 각 패킷 전송마다 클라이언트는 서버가 ACK 신호를 보내주기를 기다림
- 패킷을 받으면 서버는 클라이언트에게 ACK 신호를 보내서 성공적으로 수신했다고 알림
- 특정 시간동안 클라이언트가 ACK 신호를 받지 못하면 패킷을 다시 전송함

### 4. 흐름 제어

- 서버는 버퍼 공간(수신 가능 공간)을 관리하면서 데이터 전송 속도를 관리한다.
- 서버는 ACK 신호를 보낼 때 window size라는 것도 같이 보내는데, 이 사이즈가 작으면 수신 가능 공간이 적다는 뜻이므로 전송 속도를 늦추도록 클라이언트에게 알려줄 수 있다.

### 5. 연결 종료

- 모든 패킷이 성공적으로 수신되면 클라이언트와 서버는 연결 종료 프로세스를 진행한다.
- 데이터 전송이 완료되었다는 것을 알려주는 메시지를 교환함으로서 연결을 종료하도록 한다.
- **4-way handshake**를 이용하여 연결을 종료한다,

![image.png](https://miro.medium.com/v2/resize:fit:1100/format:webp/1*fbdBVkwKHhwyr6bi8us2cQ.png)

연결 동안, TCP는 체크섬을 이용하여 에러를 탐지한다. 에러가 발견되는 경우 패킷 재전송을 요청한다.

## TCP가 네트워크 혼잡을 처리하는 방법

TCP는 네트워크 혼잡을 관리하는 매커니즘을 갖고 있다.

1. **Slow Start**: TCP 연결이 시작되면 송신측은 전송 속도를 점진적으로 올린다. 혼잡이 느껴질 수 있는 임계값까지 속도를 올린다.
2. **Congestion Avoidance**: 혼잡이 감지되면 전송 속도를 줄인다. AIMD (Additive Increase / Multiplicative Decrease) 방법을 이용한다. 혼잡 윈도우를 곱셈 비율로 줄여가면서 혼잡을 해결한다.
3. **Congestion Window**: 전송할 수 있는 최대 패킷 개수를 의미한다. 혼잡 윈도우 크기는 네트워크 상태나 수신측으로부터 받은 혼잡 피드백에 따라 동적으로 결정된다.
4. **Explicit Congestion Notification(ECN)**: 라우터와 같은 네트워크 장치로부터 혼잡 전에 미리 받을 수 있는 사전 경고. 네트워크 장치가 패킷에 ECN을 표시하여 수신자가 ECN을 감지하면 송신자에 알리게 되고 송신자는 이 알림을 받고 전송 속도를 늦춘다.
5. **Fast Re-transmit and Fast Recovery**: 손실된 패킷을 빠르게 다시 재전송하거나 복구하는 매커니즘을 이용한다. 중복되는 ACK 신호를 받으면 TCP는 해당 패킷이 손실되었을 가능성이 높다고 판단하고 타임아웃 없이 빠르게 재전송한다. 전송 속도를 완전히 늦추지 않고 패킷을 다시 전송한다.

## 순서가 어긋난 패킷을 처리하는 방법

1. **Sequence Numbers**: 전송하는 각 패킷의 헤더에 고유한 시퀀스 넘버를 할당하는데 이 넘버를 통해 패킷의 순서를 정렬하도록 한다.
2. **Out-of-Order Arrival**: 패킷이 수신자에 순서에 어긋나게 도착한 경우 TCP는 앞의 모든 패킷이 수신될 때까지 그 패킷을 버퍼에 담아둔다. 그 후에 시퀀스 넘버를 통해 순서를 정렬한다.
3. **Selective Acknowledgment**: 일반 TCP에서는 연속적으로 잘 받은 마지막 바이트까지만 ACK을 전송한다. 하지만 중간에 일부 패킷만 손실된 경우에는 SACK을 사용할 수 있다.
   - 예를 들어, [seq=1], [seq=2], [seq=3], [seq=4], [seq=5]가 있다고 할 때 seq=3 패킷이 손실되면 ACK=3만 계속해서 보내게 된다. 그럼 3번 패킷 이후의 모든 패킷이 손실되었나?라고 생각할 수 있다.
   - 그러나 SACK=3을 보내게 되면 5개의 패킷 중에 seq=3만 도착하지 않았음을 정확히 알려줄 수 있다.
4. **Retransmission of Missing Packets**: ACK나 SACK를 통해 손실된 패킷을 감지하게 되면 재전송을 요구한다. 송신자는 손실된 패킷을 재전송하고 버퍼에 담아두었다가 다시 정렬한다.

# UDP (User Datagram Protocol)

비연결적이고 가벼운 전송 계층 프로토콜이다.

적은 오버해드와 최소한의 에러 검출을 하는 등, 스피드와 효율성이 신뢰성보다 우선되는 프로토콜이다.

## 특징

1. **Connectionless Communication**: 데이터 전송을 위해 확실한 연결을 형성하지 않는다. SYN/ACK과 같은 협상 없이 그냥 출발지에서 도착지로 데이터만 전송한다.
2. **Fast and Lightweight**: 속도와 효율성을 위해 고안되었다. 비디오/오디오 스트리밍과 같은 실시간 데이터 전송에 적합하다.
3. **Unreliable Delivery**: 패킷의 전송이나 수신 순서를 보장하지 않는다. 손실되거나 오염된 패킷에 대한 승인 또는 재전송 매커니즘을 제공하지 않는다. 그러므로 필요한 경우, 신뢰성이나 에러 검출에 대한 조치가 따로 필요하다.
4. **Datagram Size Limit**: 네트워크 구조에 따른 데이터그램 크기 제한이 있다. UDP는 자체적으로 데이터를 나누지 않기 때문에, 데이터그램 크기가 MTU보다 크면 IP 계층에서 조각화가 일어나고, UDP는 신뢰성을 보장하지 않기 때문에 조각 중 일부가 손실될 가능성이 있다.

## UDP 헤더

UDP 패킷 앞에 추가되는 필드

1. **Source Port**: 패킷을 전송하는 송신측 포트 넘버
2. **Destination Port**: 패킷을 수신받는 수신측 포트 넘버
3. **Length**: UDP 패킷의 길이
4. **Checksum**: 에러 체킹을 위한 값

## UDP가 작동하는 방법

### 1. 송신 준비

- 수신측의 IP 주소와 포트 넘버를 명시한다.

### 2. 메시지 패키징

- 메시지를 UDP 패킷(데이터그램)에 담는다.
- UDP 헤더에 송신측의 포트 넘버와 수신측의 포트 넘버를 포함한다.
- 송신측은 체크섬 값을 계산하여 수신측이 전송 오류를 체크할 수 있도록 한다.

### 3. 패킷 전송

- 패킷을 전송한다.
- 연결을 설정하지 않고 패킷을 전송하여 synchronization 없이 바로 데이터를 보낸다.

### 4. 수신

- 포트로부터 UDP 패킷을 받는다.
- 패킷이 도착하면 패킷으로부터 메시지를 추출한다.
- 송신측 포트 넘버를 사용하여 송신자를 식별한다.

### 5. 메시지 처리

- 애플리케이션에서 메시지를 처리한다.
- 패킷 전송 순서나 신뢰성을 보장하지 않으므로 필요한 경우 애플리케이션이 에러 검출을 하거나 패킷을 재정렬한다.

---

참고

- [Understanding TCP and UDP : Building Blocks of Connectivity](https://medium.com/@abhirup.acharya009/understanding-tcp-and-udp-building-blocks-of-connectivity-ec96e208b852)
